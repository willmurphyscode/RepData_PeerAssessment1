---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
```{r}
library(lubridate)
dat <- read.table(unz("activity.zip", "activity.csv"), sep=",", header=TRUE, stringsAsFactors = FALSE)
dat$date <- ymd(dat$date)
head(dat)
```

## What is mean total number of steps taken per day?
```{r}
totalPerDay <- tapply(dat$steps, factor(dat$date), sum, na.rm = TRUE)
meanPerDay <- mean(totalPerDay)
medianPerDay <- median(totalPerDay)
hist(totalPerDay, main="Histogram for Total Steps Per Day", xlab="Number of Steps Taken", breaks = 10)

```

The mean total steps per day is `r meanPerDay` and the median total steps per day is `r medianPerDay`.

## What is the average daily activity pattern?
```{r} 
meansPerInterval <- tapply(dat$steps, factor(dat$interval), mean, na.rm=TRUE)
plot(as.numeric(names(meansPerInterval)), 
     meansPerInterval, 
     type="l",
     main = "Mean Steps by 5 Minute Interval",
     xlab = "Interval (i.e. minutes after midnight, in five-minute groups)",
     ylab = "Mean Steps During Interval")
intervalWithMostSteps <- names(meansPerInterval)[which.max(meansPerInterval)]

```
The interval with the highest mean number of steps is `r intervalWithMostSteps`

## Imputing missing values
```{r} 
library(dplyr)
anyValueIsNa <- is.na(dat$steps) | is.na(dat$date) | is.na(dat$interval)
totalNas <- sum(anyValueIsNa)
dat$dayOfWeek <- wday(dat$date)
meanIntervalByWeekday <- tapply(dat$steps, interaction(dat$interval, dat$dayOfWeek), mean, na.rm = TRUE)

typicalDay <- data.frame(steps = meanIntervalByWeekday, intervalDay = names(meanIntervalByWeekday))
typicalDay <- mutate(typicalDay, intervalDay = as.character(intervalDay))


imputeValues <- function(df) {
  intervalDayInput <- paste(as.character(df$interval), as.character(df$dayOfWeek), sep =  ".")
  df$intervalDay = intervalDayInput
  print(head(unique(df$intervalDay)))
  df <- df %>% left_join(typicalDay, c("intervalDay" = "intervalDay"))
  
  df <- rename(df, steps = steps.x, imputedValue = steps.y)
  
  ixesToUpdate <- which(is.na(df$steps))
  
  df$steps[ixesToUpdate] <- df$imputedValue[ixesToUpdate]
  print(head(df))
  df
}
withImputed <- dat
withImputed <- imputeValues(withImputed)

```
The total number of rows with any missing value is `r totalNas`. 

To impute missing values, I took the average value for that interval for that weekday. For example, if a 745 on a Monday was missing, the mean of all recorded steps for 745 on Monday was used. 

```{r} 
hist(withImputed$steps)
stepsPerDayWithImputed <- tapply(withImputed$steps, withImputed$weekday, mean)
meanWithImputed <- mean(withImputed$steps)
medianWithImputed <- median(withImputed$steps)
```

## Are there differences in activity patterns between weekdays and weekends?
